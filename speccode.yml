version: 0.2

env:
  variables:
    DOCKERHUB_USERNAME: "shaharukh789"
    IMAGE_NAME: "aiweb"
  parameter-store:
    DOCKERHUB_PASSWORD: "dockerpassword"

phases:
  pre_build:
    commands:
      - echo Logging in to Docker Hub...
      - aws ssm get-parameter --name $DOCKERHUB_PASSWORD --with-decryption --query 'Parameter.Value' --output text > dockerhub_password.txt
      - export DOCKERHUB_PASSWORD=$(cat dockerhub_password.txt)
      - docker login -u $DOCKERHUB_USERNAME -p $DOCKERHUB_PASSWORD
  build:
    commands:
      - echo Build started on `date`
      - echo Building the Docker image...
      - docker build -t $DOCKERHUB_USERNAME/$IMAGE_NAME .
  post_build:
    commands:
      - echo Build completed on `date`
      - echo Pushing the Docker image to Docker Hub...
      - docker push $DOCKERHUB_USERNAME/$IMAGE_NAME
      - echo Cleaning up...
      - rm dockerhub_password.txt

artifacts:
  files:
    - '**/*'
  discard-paths: yes